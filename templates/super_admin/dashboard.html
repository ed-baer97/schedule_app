<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ü–∞–Ω–µ–ª—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .stat-card {
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">
                <i class="bi bi-shield-check"></i> –ü–∞–Ω–µ–ª—å —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            </h1>
            <div>
                <span class="text-muted me-3">–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong>{{ current_user.full_name }}</strong></span>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
                    <i class="bi bi-box-arrow-right"></i> –í—ã—Ö–æ–¥
                </a>
            </div>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ 'danger' if category=='error' else category }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        
        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="card stat-card border-primary">
                    <div class="card-body text-center">
                        <i class="bi bi-building" style="font-size: 2rem; color: #0d6efd;"></i>
                        <h3 class="mt-2">{{ stats.total_schools }}</h3>
                        <p class="text-muted mb-0">–®–∫–æ–ª</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card border-success">
                    <div class="card-body text-center">
                        <i class="bi bi-people" style="font-size: 2rem; color: #198754;"></i>
                        <h3 class="mt-2">{{ stats.total_admins }}</h3>
                        <p class="text-muted mb-0">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card border-info">
                    <div class="card-body text-center">
                        <i class="bi bi-person-badge" style="font-size: 2rem; color: #0dcaf0;"></i>
                        <h3 class="mt-2">{{ stats.total_teachers }}</h3>
                        <p class="text-muted mb-0">–£—á–∏—Ç–µ–ª–µ–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card border-warning">
                    <div class="card-body text-center">
                        <i class="bi bi-mortarboard" style="font-size: 2rem; color: #ffc107;"></i>
                        <h3 class="mt-2">{{ stats.total_classes }}</h3>
                        <p class="text-muted mb-0">–ö–ª–∞—Å—Å–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card border-danger">
                    <div class="card-body text-center">
                        <i class="bi bi-book" style="font-size: 2rem; color: #dc3545;"></i>
                        <h3 class="mt-2">{{ stats.total_subjects }}</h3>
                        <p class="text-muted mb-0">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card border-secondary">
                    <div class="card-body text-center">
                        <i class="bi bi-telegram" style="font-size: 2rem; color: #6c757d;"></i>
                        <h3 class="mt-2">{{ stats.teachers_with_telegram }}</h3>
                        <p class="text-muted mb-0">–° Telegram</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∫–æ–ª–∞–º–∏ -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-building"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∫–æ–ª–∞–º–∏</h5>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createSchoolModal">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —à–∫–æ–ª—É
                </button>
            </div>
            <div class="card-body">
                {% if schools %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                    <th>–£—á–∏—Ç–µ–ª–µ–π</th>
                                    <th>–ö–ª–∞—Å—Å–æ–≤</th>
                                    <th>–ü—Ä–µ–¥–º–µ—Ç–æ–≤</th>
                                    <th>–°–º–µ–Ω</th>
                                    <th>–ê–¥–º–∏–Ω–æ–≤</th>
                                    <th>–†–∞—Å–ø–∏—Å–∞–Ω–∏–π</th>
                                    <th>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for school_stat in stats.schools_stats %}
                                {% set activation_status = school_stat.school.get_activation_status() %}
                                <tr class="{% if activation_status.status == 'expired' or activation_status.status == 'inactive' %}table-secondary{% elif activation_status.status == 'expiring_soon' %}table-warning{% endif %}">
                                    <td>{{ school_stat.school.id }}</td>
                                    <td><strong>{{ school_stat.school.name }}</strong></td>
                                    <td>
                                        <span class="badge bg-{{ activation_status.color }}">
                                            {{ activation_status.text }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if school_stat.school.created_at %}
                                            {{ school_stat.school.created_at.strftime('%d.%m.%Y') }}
                                        {% else %}
                                            ‚Äî
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ school_stat.teachers }}
                                        {% if school_stat.teachers_with_telegram > 0 %}
                                            <br><small class="text-success">üì± {{ school_stat.teachers_with_telegram }} —Å Telegram</small>
                                        {% endif %}
                                    </td>
                                    <td>{{ school_stat.classes }}</td>
                                    <td>{{ school_stat.subjects }}</td>
                                    <td>{{ school_stat.shifts }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" 
                                                onclick="showAdminsModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                title="–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤">
                                            {{ school_stat.admins }}
                                        </button>
                                    </td>
                                    <td>
                                        –ü–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö: {{ school_stat.permanent_schedules }}<br>
                                        –í—Ä–µ–º–µ–Ω–Ω—ã—Ö: {{ school_stat.temporary_schedules }}
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-info" 
                                                onclick="showSchoolStatsModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                title="–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
                                            <i class="bi bi-graph-up"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </button>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            {% if not school_stat.school.is_actually_active() %}
                                            <button class="btn btn-success" 
                                                    onclick="showActivateSchoolModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É">
                                                <i class="bi bi-check-circle"></i>
                                            </button>
                                            {% else %}
                                            <button class="btn btn-warning" 
                                                    onclick="showDeactivateSchoolModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É">
                                                <i class="bi bi-x-circle"></i>
                                            </button>
                                            {% endif %}
                                            <button class="btn btn-outline-primary" 
                                                    onclick="showCreateAdminModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                                                <i class="bi bi-person-plus"></i>
                                            </button>
                                            <button class="btn btn-outline-info" 
                                                    onclick="showTelegramBotModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞">
                                                <i class="bi bi-telegram"></i>
                                            </button>
                                            <button class="btn btn-outline-warning" 
                                                    onclick="showClearSchoolModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã">
                                                <i class="bi bi-arrow-clockwise"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" 
                                                    onclick="showDeleteSchoolModal({{ school_stat.school.id }}, '{{ school_stat.school.name }}')"
                                                    title="–£–¥–∞–ª–∏—Ç—å —à–∫–æ–ª—É –ø–æ–ª–Ω–æ—Å—Ç—å—é">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">–ù–µ—Ç —à–∫–æ–ª. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —à–∫–æ–ª—É.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–æ–∑–¥–∞—Ç—å —à–∫–æ–ª—É -->
    <div class="modal fade" id="createSchoolModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —à–∫–æ–ª—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createSchoolForm">
                        <div class="mb-3">
                            <label for="schoolName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã *</label>
                            <input type="text" class="form-control" id="schoolName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="createSchool()">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞ -->
    <div class="modal fade" id="createAdminModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createAdminForm">
                        <input type="hidden" id="adminSchoolId">
                        <div class="mb-3">
                            <label class="form-label">–®–∫–æ–ª–∞</label>
                            <input type="text" class="form-control" id="adminSchoolName" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="adminUsername" class="form-label">–õ–æ–≥–∏–Ω *</label>
                            <input type="text" class="form-control" id="adminUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                            <input type="password" class="form-control" id="adminPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminFullName" class="form-label">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                            <input type="text" class="form-control" id="adminFullName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="createAdmin()">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ —à–∫–æ–ª—ã -->
    <div class="modal fade" id="adminsListModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —à–∫–æ–ª—ã: <span id="adminsSchoolName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="adminsListContent">
                        <p class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∫–æ–ª—ã -->
    <div class="modal fade" id="schoolStatsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∫–æ–ª—ã: <span id="statsSchoolName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="schoolStatsContent">
                        <p class="text-muted">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã -->
    <div class="modal fade" id="clearSchoolModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">‚ö†Ô∏è –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –æ—á–∏—Å—Ç–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã:
                        <ul class="mb-0 mt-2">
                            <li>–í—Å–µ—Ö —É—á–∏—Ç–µ–ª–µ–π</li>
                            <li>–í—Å–µ –∫–ª–∞—Å—Å—ã</li>
                            <li>–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</li>
                            <li>–í—Å–µ —Å–º–µ–Ω—ã –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</li>
                            <li>–í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —É—á–∏—Ç–µ–ª–µ–π</li>
                        </ul>
                        <strong class="mt-2 d-block">–®–∫–æ–ª–∞ –∏ –∞–¥–º–∏–Ω—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!</strong>
                    </div>
                    <input type="hidden" id="clearSchoolId">
                    <div class="mb-3">
                        <label class="form-label">–®–∫–æ–ª–∞</label>
                        <input type="text" class="form-control" id="clearSchoolName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="clearConfirm" class="form-label">–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã:</label>
                        <input type="text" class="form-control" id="clearConfirm" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã">
                        <small class="text-muted">–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-warning" onclick="clearSchoolData()">
                        <i class="bi bi-arrow-clockwise"></i> –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞ -->
    <div class="modal fade" id="telegramBotModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="bi bi-telegram"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞ –¥–ª—è —à–∫–æ–ª—ã</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="telegramBotSchoolId">
                    <div class="mb-3">
                        <label class="form-label">–®–∫–æ–ª–∞</label>
                        <input type="text" class="form-control" id="telegramBotSchoolName" readonly>
                    </div>
                    
                    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±–æ—Ç–∞ -->
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å Telegram –±–æ—Ç–∞:</h6>
                        <ol class="mb-0">
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ <strong>@BotFather</strong></li>
                            <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/newbot</code></li>
                            <li>–í–≤–µ–¥–∏—Ç–µ <strong>–Ω–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞</strong> (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã: "<span id="suggestedBotName"></span>")</li>
                            <li>–í–≤–µ–¥–∏—Ç–µ <strong>username –±–æ—Ç–∞</strong> (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ <code>bot</code>, –Ω–∞–ø—Ä–∏–º–µ—Ä: <code><span id="suggestedBotUsername"></span>_bot</code>)</li>
                            <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ <strong>—Ç–æ–∫–µ–Ω</strong>, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—Å—Ç @BotFather</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</li>
                        </ol>
                    </div>
                    
                    <!-- –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
                    <div id="telegramBotStatus" class="mb-3">
                        <div class="card">
                            <div class="card-body">
                                <p class="text-muted mb-0">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ -->
                    <div class="mb-3">
                        <label for="telegramBotToken" class="form-label">–¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</label>
                        <input type="text" class="form-control" id="telegramBotToken" 
                               placeholder="123456789:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                        <small class="text-muted">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –±–æ—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</small>
                    </div>
                    
                    <div class="alert alert-warning">
                        <small>
                            <strong>–í–∞–∂–Ω–æ:</strong> –ö–∞–∂–¥–∞—è —à–∫–æ–ª–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞. 
                            –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π rate limits –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∫–æ–ª.
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveTelegramBotToken()">
                        <i class="bi bi-check-circle"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É -->
    <div class="modal fade" id="activateSchoolModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="bi bi-check-circle"></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="activateSchoolId">
                    <div class="mb-3">
                        <label class="form-label">–®–∫–æ–ª–∞</label>
                        <input type="text" class="form-control" id="activateSchoolName" readonly>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —à–∫–æ–ª—ã. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã.
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="activateMonths" class="form-label">–ú–µ—Å—è—Ü–µ–≤</label>
                                <input type="number" class="form-control" id="activateMonths" min="0" max="120" value="0">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="activateDays" class="form-label">–î–Ω–µ–π</label>
                                <input type="number" class="form-control" id="activateDays" min="0" max="365" value="0">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="activateUnlimited" onchange="toggleActivationPeriod()">
                            <label class="form-check-label" for="activateUnlimited">
                                –ë–µ—Å—Å—Ä–æ—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
                            </label>
                        </div>
                    </div>
                    <div id="activationPreview" class="alert alert-secondary">
                        <small>–°—Ä–æ–∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-success" onclick="activateSchool()">
                        <i class="bi bi-check-circle"></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É -->
    <div class="modal fade" id="deactivateSchoolModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title"><i class="bi bi-x-circle"></i> –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="deactivateSchoolId">
                    <div class="mb-3">
                        <label class="form-label">–®–∫–æ–ª–∞</label>
                        <input type="text" class="form-control" id="deactivateSchoolName" readonly>
                    </div>
                    <div class="alert alert-warning">
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ü–æ—Å–ª–µ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏:
                        <ul class="mb-0 mt-2">
                            <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —à–∫–æ–ª—ã –Ω–µ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</li>
                            <li>–î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —à–∫–æ–ª—ã –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</li>
                            <li>–®–∫–æ–ª—É –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-warning" onclick="deactivateSchool()">
                        <i class="bi bi-x-circle"></i> –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –£–¥–∞–ª–∏—Ç—å —à–∫–æ–ª—É –ø–æ–ª–Ω–æ—Å—Ç—å—é -->
    <div class="modal fade" id="deleteSchoolModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —à–∫–æ–ª—É –ø–æ–ª–Ω–æ—Å—Ç—å—é</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –î–ï–ô–°–¢–í–ò–ï!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ü–û–õ–ù–û–°–¢–¨–Æ —É–¥–∞–ª–∏—Ç:
                        <ul class="mb-0 mt-2">
                            <li><strong>–°–∞–º—É —à–∫–æ–ª—É</strong> –∏–∑ —Å–∏—Å—Ç–µ–º—ã</li>
                            <li><strong>–í—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</strong> —à–∫–æ–ª—ã</li>
                            <li><strong>–ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã</strong> (–≤—Å–µ —Ñ–∞–π–ª—ã –ë–î)</li>
                            <li><strong>–í—Å–µ –¥–∞–Ω–Ω—ã–µ:</strong> —É—á–∏—Ç–µ–ª—è, –∫–ª–∞—Å—Å—ã, –ø—Ä–µ–¥–º–µ—Ç—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</li>
                        </ul>
                        <strong class="mt-2 d-block text-danger">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!</strong>
                    </div>
                    <input type="hidden" id="deleteSchoolId">
                    <div class="mb-3">
                        <label class="form-label">–®–∫–æ–ª–∞</label>
                        <input type="text" class="form-control" id="deleteSchoolName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="deleteConfirm" class="form-label">–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã:</label>
                        <input type="text" class="form-control" id="deleteConfirm" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã">
                        <small class="text-muted">–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-danger" onclick="deleteSchool()">
                        <i class="bi bi-x-circle"></i> –£–¥–∞–ª–∏—Ç—å —à–∫–æ–ª—É
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞
        const schoolsStats = {{ schools_stats_for_js|tojson|safe }};
        
        function createSchool() {
            const name = document.getElementById('schoolName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã');
                return;
            }
            
            fetch('/super-admin/schools/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —à–∫–æ–ª—ã');
            });
        }
        
        function showCreateAdminModal(schoolId, schoolName) {
            document.getElementById('adminSchoolId').value = schoolId;
            document.getElementById('adminSchoolName').value = schoolName;
            const modal = new bootstrap.Modal(document.getElementById('createAdminModal'));
            modal.show();
        }
        
        function createAdmin() {
            const schoolId = parseInt(document.getElementById('adminSchoolId').value);
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            const fullName = document.getElementById('adminFullName').value.trim();
            
            if (!username || !password || !fullName) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/admins/create`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: username,
                    password: password,
                    full_name: fullName
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
            });
        }
        
        function showAdminsModal(schoolId, schoolName) {
            const schoolStat = schoolsStats.find(s => s.school.id === schoolId);
            if (!schoolStat) return;
            
            document.getElementById('adminsSchoolName').textContent = schoolName;
            
            let html = '';
            if (schoolStat.admin_list && schoolStat.admin_list.length > 0) {
                html = '<table class="table table-hover"><thead><tr><th>–õ–æ–≥–∏–Ω</th><th>–ü–æ–ª–Ω–æ–µ –∏–º—è</th><th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
                schoolStat.admin_list.forEach(admin => {
                    const createdDate = admin.created_at ? new Date(admin.created_at).toLocaleDateString('ru-RU') : '‚Äî';
                    html += `<tr>
                        <td><strong>${admin.username}</strong></td>
                        <td>${admin.full_name}</td>
                        <td>${createdDate}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteAdmin(${schoolId}, ${admin.id}, '${admin.full_name}')">
                                <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </td>
                    </tr>`;
                });
                html += '</tbody></table>';
            } else {
                html = '<p class="text-muted text-center">–ù–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>';
            }
            
            document.getElementById('adminsListContent').innerHTML = html;
            const modal = new bootstrap.Modal(document.getElementById('adminsListModal'));
            modal.show();
        }
        
        function deleteAdmin(schoolId, adminId, adminName) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ü–û–õ–ù–û–°–¢–¨–Æ —É–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ "${adminName}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`)) {
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/admins/${adminId}/delete`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
            });
        }
        
        function showSchoolStatsModal(schoolId, schoolName) {
            const schoolStat = schoolsStats.find(s => s.school.id === schoolId);
            if (!schoolStat) return;
            
            document.getElementById('statsSchoolName').textContent = schoolName;
            
            const stats = schoolStat;
            const html = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="bi bi-people"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–£—á–∏—Ç–µ–ª–µ–π:</strong> ${stats.teachers}</p>
                                <p><strong>–° Telegram:</strong> ${stats.teachers_with_telegram || 0}</p>
                                <p><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</strong> ${stats.admins}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="bi bi-book"></i> –£—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–ö–ª–∞—Å—Å–æ–≤:</strong> ${stats.classes}</p>
                                <p><strong>–ü—Ä–µ–¥–º–µ—Ç–æ–≤:</strong> ${stats.subjects}</p>
                                <p><strong>–°–º–µ–Ω:</strong> ${stats.shifts}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="bi bi-calendar-check"></i> –†–∞—Å–ø–∏—Å–∞–Ω–∏—è</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö:</strong> ${stats.permanent_schedules || 0}</p>
                                <p><strong>–í—Ä–µ–º–µ–Ω–Ω—ã—Ö:</strong> ${stats.temporary_schedules || 0}</p>
                                <p><strong>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:</strong> ${(stats.permanent_schedules || 0) + (stats.temporary_schedules || 0)}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-white">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>–£—á–∏—Ç–µ–ª–µ–π –Ω–∞ –∫–ª–∞—Å—Å:</strong> ${stats.avg_teachers_per_class || 0}</p>
                                <p><strong>–ü—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–∞ –∫–ª–∞—Å—Å:</strong> ${stats.avg_subjects_per_class || 0}</p>
                                <p><strong>–ù–∞–≥—Ä—É–∑–æ–∫ –∫–ª–∞—Å—Å–æ–≤:</strong> ${stats.total_class_loads || 0}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('schoolStatsContent').innerHTML = html;
            const modal = new bootstrap.Modal(document.getElementById('schoolStatsModal'));
            modal.show();
        }
        
        function showClearSchoolModal(schoolId, schoolName) {
            document.getElementById('clearSchoolId').value = schoolId;
            document.getElementById('clearSchoolName').value = schoolName;
            document.getElementById('clearConfirm').value = '';
            const modal = new bootstrap.Modal(document.getElementById('clearSchoolModal'));
            modal.show();
        }
        
        function clearSchoolData() {
            const schoolId = parseInt(document.getElementById('clearSchoolId').value);
            const schoolName = document.getElementById('clearSchoolName').value;
            const confirmText = document.getElementById('clearConfirm').value.trim();
            
            if (!confirmText) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–í—ã –¢–û–ß–ù–û —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã "${schoolName}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!`)) {
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/clear`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    confirm: confirmText
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–î–∞–Ω–Ω—ã–µ —à–∫–æ–ª—ã —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã');
            });
        }
        
        function showDeleteSchoolModal(schoolId, schoolName) {
            document.getElementById('deleteSchoolId').value = schoolId;
            document.getElementById('deleteSchoolName').value = schoolName;
            document.getElementById('deleteConfirm').value = '';
            const modal = new bootstrap.Modal(document.getElementById('deleteSchoolModal'));
            modal.show();
        }
        
        function showActivateSchoolModal(schoolId, schoolName) {
            document.getElementById('activateSchoolId').value = schoolId;
            document.getElementById('activateSchoolName').value = schoolName;
            document.getElementById('activateMonths').value = 0;
            document.getElementById('activateDays').value = 0;
            document.getElementById('activateUnlimited').checked = false;
            toggleActivationPeriod();
            const modal = new bootstrap.Modal(document.getElementById('activateSchoolModal'));
            modal.show();
        }
        
        function toggleActivationPeriod() {
            const unlimited = document.getElementById('activateUnlimited').checked;
            const monthsInput = document.getElementById('activateMonths');
            const daysInput = document.getElementById('activateDays');
            
            monthsInput.disabled = unlimited;
            daysInput.disabled = unlimited;
            
            if (unlimited) {
                document.getElementById('activationPreview').innerHTML = '<strong>–ë–µ—Å—Å—Ä–æ—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è</strong>';
                document.getElementById('activationPreview').className = 'alert alert-success';
            } else {
                updateActivationPreview();
            }
        }
        
        function updateActivationPreview() {
            const months = parseInt(document.getElementById('activateMonths').value) || 0;
            const days = parseInt(document.getElementById('activateDays').value) || 0;
            const preview = document.getElementById('activationPreview');
            
            if (months === 0 && days === 0) {
                preview.innerHTML = '<small>–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ –∏/–∏–ª–∏ –¥–Ω–µ–π</small>';
                preview.className = 'alert alert-secondary';
            } else {
                const totalDays = (months * 30) + days;
                const futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + totalDays);
                const dateStr = futureDate.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });
                preview.innerHTML = `<strong>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –¥–æ: ${dateStr}</strong> (${totalDays} –¥–Ω–µ–π)`;
                preview.className = 'alert alert-info';
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
        document.addEventListener('DOMContentLoaded', function() {
            const monthsInput = document.getElementById('activateMonths');
            const daysInput = document.getElementById('activateDays');
            if (monthsInput) {
                monthsInput.addEventListener('input', updateActivationPreview);
            }
            if (daysInput) {
                daysInput.addEventListener('input', updateActivationPreview);
            }
        });
        
        function activateSchool() {
            const schoolId = parseInt(document.getElementById('activateSchoolId').value);
            const unlimited = document.getElementById('activateUnlimited').checked;
            const months = unlimited ? 0 : (parseInt(document.getElementById('activateMonths').value) || 0);
            const days = unlimited ? 0 : (parseInt(document.getElementById('activateDays').value) || 0);
            
            if (!unlimited && months === 0 && days === 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ –∏/–∏–ª–∏ –¥–Ω–µ–π –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –±–µ—Å—Å—Ä–æ—á–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é');
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/activate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    months: months,
                    days: days
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–®–∫–æ–ª–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —à–∫–æ–ª—ã');
            });
        }
        
        function showDeactivateSchoolModal(schoolId, schoolName) {
            document.getElementById('deactivateSchoolId').value = schoolId;
            document.getElementById('deactivateSchoolName').value = schoolName;
            const modal = new bootstrap.Modal(document.getElementById('deactivateSchoolModal'));
            modal.show();
        }
        
        function deactivateSchool() {
            const schoolId = parseInt(document.getElementById('deactivateSchoolId').value);
            const schoolName = document.getElementById('deactivateSchoolName').value;
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —à–∫–æ–ª—É "${schoolName}"?\n\n–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –Ω–µ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.`)) {
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/deactivate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–®–∫–æ–ª–∞ —É—Å–ø–µ—à–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —à–∫–æ–ª—ã');
            });
        }
        
        function deleteSchool() {
            const schoolId = parseInt(document.getElementById('deleteSchoolId').value);
            const schoolName = document.getElementById('deleteSchoolName').value;
            const confirmText = document.getElementById('deleteConfirm').value.trim();
            
            if (!confirmText) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–í–ù–ò–ú–ê–ù–ò–ï! –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ò–¢–¨ —à–∫–æ–ª—É "${schoolName}"!\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç:\n- –°–∞–º—É —à–∫–æ–ª—É\n- –í—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\n- –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —à–∫–æ–ª—ã\n- –í—Å–µ –¥–∞–Ω–Ω—ã–µ\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û!\n\n–í—ã –¢–û–ß–ù–û —É–≤–µ—Ä–µ–Ω—ã?`)) {
                return;
            }
            
            fetch(`/super-admin/schools/${schoolId}/delete`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    confirm: confirmText
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–®–∫–æ–ª–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —à–∫–æ–ª—ã');
            });
        }
        
        function showTelegramBotModal(schoolId, schoolName) {
            document.getElementById('telegramBotSchoolId').value = schoolId;
            document.getElementById('telegramBotSchoolName').value = schoolName;
            document.getElementById('suggestedBotName').textContent = schoolName;
            // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º username –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è —à–∫–æ–ª—ã (—Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞)
            const suggestedUsername = schoolName.toLowerCase()
                .replace(/[^a-z–∞-—è0-9]/g, '_')
                .replace(/_+/g, '_')
                .replace(/^_|_$/g, '')
                .substring(0, 20);
            document.getElementById('suggestedBotUsername').textContent = suggestedUsername || 'school';
            document.getElementById('telegramBotToken').value = '';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
            checkTelegramBotStatus(schoolId);
            
            const modal = new bootstrap.Modal(document.getElementById('telegramBotModal'));
            modal.show();
        }
        
        function checkTelegramBotStatus(schoolId) {
            const statusDiv = document.getElementById('telegramBotStatus');
            statusDiv.innerHTML = '<div class="card"><div class="card-body"><p class="text-muted mb-0">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</p></div></div>';
            
            fetch(`/super-admin/schools/${schoolId}/telegram-token/check`)
                .then(r => r.json())
                .then(result => {
                    if (result.success && result.has_token) {
                        const botInfo = result.bot_info;
                        statusDiv.innerHTML = `
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="text-success"><i class="bi bi-check-circle"></i> Telegram –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω</h6>
                                    <p class="mb-1"><strong>–ò–º—è –±–æ—Ç–∞:</strong> ${botInfo.first_name}</p>
                                    <p class="mb-1"><strong>Username:</strong> @${botInfo.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                    <p class="mb-0"><strong>ID –±–æ—Ç–∞:</strong> ${botInfo.id}</p>
                                </div>
                            </div>
                        `;
                    } else if (result.has_token) {
                        statusDiv.innerHTML = `
                            <div class="card border-danger">
                                <div class="card-body">
                                    <h6 class="text-danger"><i class="bi bi-exclamation-triangle"></i> –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω</h6>
                                    <p class="mb-0 text-muted">${result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞'}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML = `
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h6 class="text-warning"><i class="bi bi-info-circle"></i> Telegram –±–æ—Ç –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</h6>
                                    <p class="mb-0 text-muted">–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—â–∏–π –±–æ—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
                                </div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    statusDiv.innerHTML = `
                        <div class="card border-danger">
                            <div class="card-body">
                                <p class="text-danger mb-0">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞</p>
                            </div>
                        </div>
                    `;
                });
        }
        
        function saveTelegramBotToken() {
            const schoolId = parseInt(document.getElementById('telegramBotSchoolId').value);
            const token = document.getElementById('telegramBotToken').value.trim();
            
            fetch(`/super-admin/schools/${schoolId}/telegram-token`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    telegram_token: token
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || '–¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    if (result.bot_info) {
                        alert(`–ë–æ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω:\n–ò–º—è: ${result.bot_info.first_name}\nUsername: @${result.bot_info.username}`);
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    checkTelegramBotStatus(schoolId);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞');
            });
        }
    </script>
</body>
</html>

