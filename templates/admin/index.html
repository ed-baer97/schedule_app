{% extends "admin/base.html" %}
{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-3">
            <i class="bi bi-speedometer2"></i> Админ панель
        </h2>
        <p class="text-muted">Управление данными школы, учителями, классами и предметами</p>
    </div>
</div>

<!-- Карточки разделов -->
<div class="row g-4 mb-4">
    <!-- Учителя -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-people fs-2 text-primary"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Учителя</h5>
                        <small class="text-muted">Управление учителями</small>
                    </div>
                </div>
                <p class="card-text">Просмотр и редактирование списка учителей, их назначений на предметы и классы.</p>
                <a href="/admin/teachers" class="btn btn-primary">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Предметы -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-secondary bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-book fs-2 text-secondary"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Предметы</h5>
                        <small class="text-muted">Управление предметами</small>
                    </div>
                </div>
                <p class="card-text">Просмотр предметов и назначение учителей на предметы и классы.</p>
                <a href="/admin/subjects" class="btn btn-secondary">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Классы -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-mortarboard fs-2 text-primary"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Классы</h5>
                        <small class="text-muted">Предметы и учителя</small>
                    </div>
                </div>
                <p class="card-text">Просмотр классов с предметами, учителями и количеством часов в неделю.</p>
                <a href="/admin/classes" class="btn btn-primary">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Нагрузка классов -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-success bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-calendar-check fs-2 text-success"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Нагрузка классов</h5>
                        <small class="text-muted">Часы по предметам</small>
                    </div>
                </div>
                <p class="card-text">Настройка количества часов в неделю для каждого предмета в каждом классе.</p>
                <a href="/admin/class-loads" class="btn btn-success">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Вторая строка карточек -->
<div class="row g-4 mb-4">
    <!-- Нагрузка учителей -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-info bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-person-check fs-2 text-info"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Нагрузка учителей</h5>
                        <small class="text-muted">Общая нагрузка</small>
                    </div>
                </div>
                <p class="card-text">Просмотр общей нагрузки каждого учителя в неделю и их назначений.</p>
                <a href="/admin/teacher-workload" class="btn btn-info">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Загрузка Excel -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-warning bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-upload fs-2 text-warning"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Загрузка Excel</h5>
                        <small class="text-muted">Импорт данных</small>
                    </div>
                </div>
                <p class="card-text">Загрузка данных из Excel-файлов: нагрузка классов и назначения учителей.</p>
                <a href="/admin/upload" class="btn btn-warning">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Расписание -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-dark bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-calendar-week fs-2 text-dark"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Расписание</h5>
                        <small class="text-muted">Управление расписанием</small>
                    </div>
                </div>
                <p class="card-text">Создание и редактирование постоянного и временного расписания уроков.</p>
                <a href="/admin/schedule" class="btn btn-dark">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
    
    <!-- Настройки API -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
                        <i class="bi bi-plug fs-2 text-primary"></i>
                    </div>
                    <div>
                        <h5 class="card-title mb-0">Настройки API</h5>
                        <small class="text-muted">AI и Telegram</small>
                    </div>
                </div>
                <p class="card-text">Настройка API ключей для AI моделей и Telegram бота для вашей школы.</p>
                <a href="/admin/api-settings" class="btn btn-primary">
                    <i class="bi bi-arrow-right"></i> Перейти
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Опасная зона -->
<div class="row">
    <div class="col-12">
        <div class="card border-warning shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Опасная зона</h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Вы можете очистить все данные школы. Это действие удалит:</p>
                <ul>
                    <li>Всех учителей</li>
                    <li>Все классы</li>
                    <li>Все предметы</li>
                    <li>Все смены и расписания</li>
                    <li>Все назначения учителей</li>
                </ul>
                <p class="text-danger mb-3"><strong>Это действие необратимо!</strong></p>
                <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#clearDatabaseModal">
                    <i class="bi bi-arrow-clockwise"></i> Очистить базу данных
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно: Очистить базу данных -->
    <div class="modal fade" id="clearDatabaseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">⚠️ Очистить базу данных</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>ВНИМАНИЕ!</strong> Это действие удалит ВСЕ данные школы:
                        <ul class="mb-0 mt-2">
                            <li>Всех учителей</li>
                            <li>Все классы</li>
                            <li>Все предметы</li>
                            <li>Все смены и расписания</li>
                            <li>Все назначения учителей</li>
                        </ul>
                        <strong class="mt-2 d-block text-danger">Это действие НЕОБРАТИМО!</strong>
                    </div>
                    <div class="mb-3">
                        <label for="clearConfirmText" class="form-label">Для подтверждения введите название школы:</label>
                        <input type="text" class="form-control" id="clearConfirmText" 
                               placeholder="Введите название школы"
                               data-school-name="{{ school_name if school_name else '' }}">
                        <small class="text-muted">Для безопасности введите точное название школы</small>
                    </div>
                    <div id="clearDatabaseError" class="alert alert-danger d-none"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="button" class="btn btn-warning" onclick="clearDatabase()">
                        <i class="bi bi-arrow-clockwise"></i> Очистить базу данных
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function clearDatabase() {
            const confirmText = document.getElementById('clearConfirmText').value.trim();
            const errorDiv = document.getElementById('clearDatabaseError');
            
            if (!confirmText) {
                errorDiv.textContent = 'Введите название школы для подтверждения';
                errorDiv.classList.remove('d-none');
                return;
            }
            
            if (!confirm('Вы ТОЧНО уверены, что хотите очистить ВСЕ данные школы?\n\nЭто действие НЕОБРАТИМО!')) {
                return;
            }
            
            fetch('/admin/clear-database', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    confirm: confirmText
                })
            })
            .then(r => r.json())
            .then(result => {
                if (result.success) {
                    alert(result.message || 'База данных успешно очищена');
                    location.reload();
                } else {
                    errorDiv.textContent = result.error || 'Ошибка при очистке базы данных';
                    errorDiv.classList.remove('d-none');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                errorDiv.textContent = 'Ошибка при очистке базы данных';
                errorDiv.classList.remove('d-none');
            });
        }
    </script>
</div>
{% endblock %}