# Ограничения и рекомендации для рассылок в Telegram

## Текущие ограничения

### 1. База данных (SQLite)
- **Теоретический лимит**: SQLite может хранить до **281 триллиона записей** (2^64)
- **Практический лимит**: Для рассылок ограничений практически нет
- **Производительность**: 
  - Чтение: очень быстрое даже для тысяч учителей
  - Запись: ограничена одновременными операциями (1 запись за раз, или несколько с WAL)

### 2. Telegram API Rate Limits
- **Группы сообщений**: 30 сообщений в секунду
- **Отдельные сообщения**: ~20 сообщений в секунду на бота
- **При превышении**: Telegram вернет ошибку 429 (Too Many Requests)

### 3. Текущая реализация
- Отправка происходит **последовательно** (одно за другим)
- **Нет задержек** между отправками
- **Нет обработки rate limits** от Telegram
- Timeout: 10 секунд на запрос

## Рекомендации

### Для малых школ (до 50 учителей)
✅ Текущая реализация работает нормально
- Время отправки: ~2-5 секунд
- Нет риска превышения лимитов Telegram

### Для средних школ (50-200 учителей)
⚠️ Нужны улучшения:
- Добавить задержку 0.05-0.1 секунды между отправками
- Время отправки: ~10-20 секунд
- Риск таймаута HTTP запроса (обычно 30-60 секунд)

### Для больших школ (200+ учителей)
❌ Требуется оптимизация:
- Использовать асинхронную отправку (Celery, Background tasks)
- Добавить обработку rate limits
- Разбить на батчи
- Время отправки: может занять минуты

## Предлагаемые улучшения

1. **Добавить задержки между отправками**
   ```python
   import time
   time.sleep(0.1)  # 100ms между сообщениями
   ```

2. **Обработка rate limits**
   ```python
   if response.status_code == 429:
       retry_after = int(response.headers.get('Retry-After', 60))
       time.sleep(retry_after)
   ```

3. **Асинхронная отправка** (для больших школ)
   - Использовать Celery или Flask background tasks
   - Отправлять в фоне, возвращать статус сразу

4. **Батчинг**
   - Разбить учителей на группы по 20-30 человек
   - Отправлять с паузами между батчами

## Практические лимиты

| Количество учителей | Время отправки | Статус |
|---------------------|----------------|--------|
| До 50               | 2-5 сек        | ✅ OK  |
| 50-100              | 5-10 сек       | ⚠️ Медленно |
| 100-200             | 10-20 сек      | ⚠️ Риск таймаута |
| 200-500             | 20-50 сек      | ❌ Таймаут |
| 500+                | 50+ сек        | ❌ Требуется оптимизация |

## Вывод

**База данных не ограничивает количество рассылок** - SQLite легко справляется с тысячами учителей.

**Основные ограничения:**
1. Telegram API rate limits (20-30 сообщений/сек)
2. HTTP таймауты (обычно 30-60 секунд)
3. Производительность приложения при большом количестве запросов

**Рекомендация**: Для школ с более чем 100 учителями добавить оптимизацию отправки.

