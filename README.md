# Система управления расписанием занятий

Веб-приложение для автоматизации процесса составления и управления расписанием учебных занятий в образовательных учреждениях.

## Возможности

- Автоматическая генерация расписания с учетом всех ограничений
- Управление данными школы (классы, предметы, учителя, кабинеты)
- Многопользовательская система с поддержкой нескольких школ
- Интеграция с Telegram для отправки расписания учителям
- Импорт данных из Excel
- Интеллектуальная генерация расписания с оптимизацией

## Развертывание на Render

### Предварительные требования

1. Аккаунт на [Render.com](https://render.com)
2. Репозиторий с кодом на GitHub/GitLab/Bitbucket

### Шаги развертывания

1. **Подготовка репозитория**
   - Убедитесь, что все файлы закоммичены и запушены в репозиторий
   - Файлы `Procfile`, `requirements.txt` и `render.yaml` уже включены в проект

2. **Создание сервиса на Render**
   - Войдите в панель Render
   - Нажмите "New +" → "Web Service"
   - Подключите ваш репозиторий
   - Render автоматически определит настройки из `render.yaml` или вы можете настроить вручную:
     - **Build Command**: `pip install --upgrade pip setuptools wheel && pip install --prefer-binary -r requirements.txt`
     - **Start Command**: `gunicorn app:app`
     - **Environment**: `Python 3`
     - **Python Version**: `3.11.0` ⚠️ **ВАЖНО**: Укажите вручную в настройках сервиса!
   
   ⚠️ **Важно**: 
   - Build command использует `--prefer-binary` для установки предкомпилированных wheels, что избегает этапа "Preparing metadata (pyproject.toml)" и ускоряет установку
   - Если Render использует Python 3.13+, это может вызвать проблемы. Обязательно укажите Python 3.11.0 в настройках!

3. **Настройка переменных окружения**

   В разделе "Environment" добавьте следующие переменные:

   **Обязательные:**
   - `SECRET_KEY` - секретный ключ для Flask (можно сгенерировать через Render или использовать команду: `python -c "import secrets; print(secrets.token_hex(32))"`)

   **Рекомендуемые:**
   - `TELEGRAM_BOT_TOKEN` - токен Telegram бота (если используется Telegram интеграция)
   - `DASHSCOPE_API_KEY` - API ключ для Qwen AI (если используется AI генерация)
   - `QWEN_MODEL` - модель Qwen (по умолчанию: `qwen-plus`)

   **Опциональные:**
   - `DEEPSEEK_API_KEY` - API ключ для DeepSeek (альтернатива Qwen)
   - `OPENAI_API_KEY` - API ключ для OpenAI (альтернатива)
   - `YANDEX_GPT_API_KEY` - API ключ для Yandex GPT (альтернатива)

4. **Инициализация базы данных**

   После первого деплоя:
   - Откройте ваш сайт: `https://your-app.onrender.com/init-db`
   - Это создаст системную БД и первого супер-администратора:
     - **Логин**: `admin`
     - **Пароль**: `admin123`
   - ⚠️ **ВАЖНО**: Сразу измените пароль после первого входа!

5. **⚠️ ВАЖНО: Хранение данных на Render**

   По умолчанию приложение использует SQLite, который хранит данные в файловой системе.
   **На Render файловая система эфемерная**, поэтому данные будут теряться при:
   - Перезапуске сервиса
   - Обновлении кода
   - Перезапуске контейнера

   **Решения:**
   
   **Вариант 1: Render Disk (рекомендуется для начала)**
   - В настройках сервиса добавьте Render Disk
   - Укажите путь монтирования (например, `/data`)
   - Обновите пути к БД в `app/core/db_manager.py` для использования `/data/system.db` и `/data/databases/`
   
   **Вариант 2: PostgreSQL (для продакшена)**
   - Создайте PostgreSQL базу данных на Render
   - Требует миграции кода для использования PostgreSQL вместо SQLite
   - Более надежное решение для продакшена
   
   **Вариант 3: Внешнее хранилище**
   - Используйте S3-совместимое хранилище для резервных копий
   - Настройте автоматическое резервное копирование БД

### Структура проекта

```
schedule_app/
├── app/                    # Основное приложение
│   ├── core/              # Ядро (БД, авторизация)
│   ├── models/            # Модели данных
│   ├── routes/             # Маршруты
│   ├── services/           # Сервисы
│   └── templates/          # HTML шаблоны
├── config.py              # Конфигурация
├── app.py                 # Главный файл приложения
├── requirements.txt       # Зависимости Python
├── Procfile               # Команда запуска для Render
├── render.yaml            # Конфигурация Render
└── .env.example           # Пример переменных окружения
```

### Локальная разработка

1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. Создайте файл `.env` на основе `.env.example` и заполните переменные

3. Запустите приложение:
   ```bash
   python app.py
   ```

4. Откройте в браузере: `http://localhost:5000`

### Примечания

- Приложение автоматически создает необходимые директории (`uploads/`, `databases/`) при первом запуске
- На Render используйте переменные окружения для всех секретных данных
- Не коммитьте файл `.env` в репозиторий (используйте `env.example` как шаблон)
- ⚠️ **КРИТИЧЕСКИ ВАЖНО**: На Render файловая система эфемерная - данные SQLite теряются при перезапуске!
- Регулярно делайте резервные копии базы данных
- Для продакшена рассмотрите использование PostgreSQL или Render Disk (см. раздел выше)

### Поддержка

При возникновении проблем проверьте логи в панели Render или обратитесь к документации Render.

#   s c h e d u l e _ a p p 
 
 